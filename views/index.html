<html>
<head>
    <title>ReactJS - Event CMS</title>
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="/node_modules/react/dist/react.min.js"></script>
    <script src="/node_modules/react/dist/JSXTransformer.js"></script>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
</head>
<body>
<div class="container">
    <div class="page-header">
        <h1>ReactJS - Event CMS</h1>
    </div>
    <div id="companyApp"></div>
</div>
<script type="text/jsx">
    /** @jsx React.DOM */
    var CompanyApp = React.createClass({
        getInitialState: function() {
            return {companylist:this.props.companies};
        },
        handleNewRowSubmit: function( newcompany ) {
            this.setState( {companylist: this.state.companylist.concat([newcompany])} );
        },
        handleCompanyRemove: function( company ) {

            var index = -1;
            var clength = this.state.companylist.length;
            for( var i = 0; i < clength; i++ ) {
                if( this.state.companylist[i].cname === company.cname ) {
                    index = i;
                    break;
                }
            }
            this.state.companylist.splice( index, 1 );
            this.setState( {companylist: this.state.companylist} );
        },
        render: function() {
            var tableStyle = {width: '100%'};
            var leftTdStyle = {width: '50%',padding:'20px',verticalAlign: 'top'};
            var rightTdStyle = {width: '50%',padding:'20px',verticalAlign: 'top'};
            return (
                    <table style={tableStyle}>
                        <tr>
                            <td style={leftTdStyle}>
                                <CompanyList clist={this.state.companylist}  onCompanyRemove={this.handleCompanyRemove}/>
                            </td>
                            <td style={rightTdStyle}>
                                <NewRow onRowSubmit={this.handleNewRowSubmit}/>
                            </td>
                        </tr>
                    </table>
            );
        }
    });

    var CompanyList = React.createClass({
        handleCompanyRemove: function(company){
            this.props.onCompanyRemove( company );
        },
        render: function() {
            var companies = [];
            var that = this; // TODO: Needs to find out why that = this made it work; Was getting error that onCompanyDelete is not undefined
            this.props.clist.forEach(function(company) {
                companies.push(<Company company={company} onCompanyDelete={that.handleCompanyRemove} /> );
            });
            return (
                    <div>
                        <h3>Events: </h3>
                        <table className="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Event Title</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Featured</th>
                                    <th>Created At</th>
                                    <th>Updated At</th>
                                </tr>
                            </thead>
                            <tbody>{companies}</tbody>
                        </table>
                    </div>
            );
        }
    });

    var Company = React.createClass({
        handleRemoveCompany: function() {
            this.props.onCompanyDelete( this.props.company );
            return false;
        },
        render: function() {
            return (
                    <tr>
                        <td>{this.props.company.id}</td>
                        <td>{this.props.company.event_title}</td>
                        <td>{this.props.company.start_date}</td>
                        <td>{this.props.company.end_date}</td>
                        <td>{this.props.company.category}</td>
                        <td>{this.props.company.description}</td>
                        <td>{this.props.company.featured}</td>
                        <td>{this.props.company.created_at}</td>
                        <td>{this.props.company.updated_at}</td>
                        <td><input type="button"  className="btn btn-primary" value="Remove" onClick={this.handleRemoveCompany}/></td>
                        <td><input type="button"  className="btn btn-primary" value="Edit" onClick={this.handleRemoveCompany}/></td>
                    </tr>
            );
        }
    });

    var NewRow = React.createClass({
        handleSubmit: function() {
            var id = 4;
            var event_title = this.refs.event_title.getDOMNode().value;
            var start_date = this.refs.start_date.getDOMNode().value;
            var end_date = this.refs.end_date.getDOMNode().value;
            var category = this.refs.category.getDOMNode().value;
            var description = this.refs.description.getDOMNode().value;
            var featured = this.refs.featured.getDOMNode().value;
            var created_at = '12-01-2016 00:00:00';
            var updated_at = '12-01-2016 00:00:00';
            var newrow = {
                id: id,
                event_title: event_title,
                start_date: start_date,
                end_date: end_date,
                category: category,
                description: description,
                featured: featured,
                created_at: created_at,
                updated_at: updated_at
            };
            this.props.onRowSubmit( newrow );

            this.refs.event_title.getDOMNode().value = '';
            this.refs.start_date.getDOMNode().value = '';
            this.refs.end_date.getDOMNode().value = '';
            this.refs.category.getDOMNode().value = '';
            this.refs.description.getDOMNode().value = '';
            this.refs.featured.getDOMNode().value = false;
            return false;
        },
        render: function() {
            var inputStyle = {padding:'12px'}
            return (
                    <div className="well">
                        <h3>Add Event</h3>
                        <form onSubmit={this.handleSubmit}>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8"  placeholder="Event Title" ref="event_title"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8" placeholder="Start Date" ref="start_date"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8" placeholder="End Date" ref="end_date"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8" placeholder="Category" ref="category"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8" placeholder="Description" ref="description"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="text"  className="form-control col-md-8" placeholder="Featured" ref="featured"/>
                            </div>
                            <div className="input-group input-group-lg" style={inputStyle}>
                                <input type="submit"  className="btn btn-primary" value="Add Event"/>
                            </div>
                        </form>
                    </div>
            );
        }
    });
    var defCompanies = [
        {id:1,event_title:'Annual Winter Festival',start_date:"12-18-2016", end_date: "12-20-2016", category: "Public Event", description: "The cities annual winter festival", featured: true, created_at: '11-15-2016 00:00:00', updated_at: '11-15-2016 00:00:00'},
        {id:2,event_title:'Wild Cats Football',start_date:"12-10-2016", end_date: "12-10-2016", category: "Sports Event", description: "Wild Cats vs Panthers", featured: true, created_at: '11-15-2016 00:00:00', updated_at: '11-15-2016 00:00:00'}
    ];
    React.renderComponent( <CompanyApp companies={defCompanies}/>, document.getElementById( "companyApp" ) );
</script>
</body>
</html>
